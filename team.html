<!DOCTYPE html>
<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="general.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js" charset="utf-8"></script>
    <title>Random Pokemon Team Generator</title>
</head>

<body>
    <div class="row container justify-content-center">
        <div id="pokebase" class="col-xl-9">
            <script>
                class pokemon {
                    constructor() {
                        var iv = [0, 0, 0, 0, 0, 0];
                        var ev = [0, 0, 0, 0, 0, 0];
                        this.generatenumber();
                        this.searchpokemon();
                        this.searchpokemonimage();
                        this.generateiv();
                        this.generateev();
                        this.fixiv();
                        this.fixev();
                    }
                    fixiv() {
                        for (let i = 0; i < 6; i++) {
                            if (this.iv[i] > 31) {
                                this.iv[i] = 31
                            }
                            else if (this.iv[i] < 0) {
                                this.iv[i] = 0
                            }
                        }
                    }
                    fixev() {
                        var totalev = 0;
                        for (let i = 0; i < 6; i++) {
                            if (this.ev[i] > 255) {
                                this.ev[i] = 255;
                            } else if (this.ev[i] < 0) {
                                this.ev[i] = 0;
                            }
                            totalev += this.ev[i];
                            if (totalev > 510) {
                                console.log("total: " + totalev);
                                this.ev[i] -= (totalev - 510);
                                totalev = 510;
                            }
                            if (this.ev[i] > 255) {
                                this.ev[i] = 255;
                            } else if (this.ev[i] < 0) {
                                this.ev[i] = 0;
                            }

                        }
                    }


                    //genero el número de pokemon entre el 1 y el 622
                    generatenumber() {
                        this.number = Math.floor(1 + Math.random() * 622)
                    }

                    //busco el nombre del pokemon en la lista
                    async searchpokemon() {
                        await fetch("pokemon.txt")
                            .then(response => response.text())
                            .then(list => {
                                let pokelist = list.split("\n");
                                this.name = pokelist[this.number - 1];
                                console.log(name);
                            });
                    }
                    // genero el src de la imágen.
                    searchpokemonimage() {
                        this.imagesrc = "images/" + this.number + ".png";
                    }
                    //genera los IV
                    generateiv() {
                        this.iv = [0, 0, 0, 0, 0, 0];
                        for (let i = 0; i < 6; i++) {
                            var rng = Math.floor(Math.random() * 31);
                            this.iv[i] = rng;
                        }
                    }
                    //genera los EV
                    generateev() {
                        this.ev = [0, 0, 0, 0, 0, 0];
                        for (let i = 0; i < 510; i++) {
                            var rng = Math.floor(Math.random() * 6);
                            this.ev[rng]++;
                        }
                        this.fixev();
                    }
                }
                //generar equipo
                var poketeam = [];
                async function createTeam() {
                    for (let i = 0; i < 6; i++) {
                        poketeam[i] = new pokemon();
                    }
                }
                function visualizeContent() {
                    for (let i = 0; i < 6; i++) {
                        var row = document.createElement("div");
                        row.classList.add("row");
                        row.id = "row" + i;
                        document.getElementById("pokebase").appendChild(row);

                        var pokename = document.createElement("h1");
                        pokename.classList.add("pokename");
                        pokename.id = "pokename" + i;
                        pokename.innerHTML = "#"+poketeam[i].number+ " " + poketeam[i].name;
                        document.getElementById("row" + i).appendChild(pokename);

                        var subrow = document.createElement("div");
                        subrow.classList.add("row");
                        subrow.id = "subrow" + i;
                        document.getElementById("row" + i).appendChild(subrow);

                        var imgcontainer = document.createElement("div");
                        imgcontainer.classList.add("imgcontainer");
                        imgcontainer.classList.add("justify-content-center");
                        imgcontainer.classList.add("col-xl-4");
                        imgcontainer.id = "imgcontainer" + i;
                        document.getElementById("subrow" + i).appendChild(imgcontainer);

                        var pokeimage = document.createElement("img");
                        pokeimage.classList.add("pokeimg");
                        pokeimage.id = "pokeimg" + i;
                        pokeimage.src = poketeam[i].imagesrc;
                        document.getElementById("imgcontainer" + i).appendChild(pokeimage);

                        var ivcontainer = document.createElement("div");
                        ivcontainer.classList.add("ivcontainer");
                        ivcontainer.classList.add("justify-content-center");
                        ivcontainer.classList.add("col-xl-4");
                        ivcontainer.id = "ivcontainer" + i;
                        document.getElementById("subrow" + i).appendChild(ivcontainer);

                        var evcontainer = document.createElement("div");
                        evcontainer.classList.add("evcontainer");
                        evcontainer.classList.add("justify-content-center");
                        evcontainer.classList.add("col-xl-4");
                        evcontainer.id = "evcontainer" + i;
                        document.getElementById("subrow" + i).appendChild(evcontainer);

                        var iv = {
                            x: ["HP", "ATK", "DEF", "SPA", "SPD", "SPE"],
                            y: poketeam[i].iv,
                            name: 'IV',
                            type: 'bar'
                        };
                        var iv = [iv];
                        var layout = {
                            xaxis: { title: 'Stats' },
                            yaxis: {
                                title: 'IV',
                                range: [0, 31]
                            },
                            barmode: 'fixed',
                            title: '',
                        };
                        Plotly.newPlot('ivcontainer' + i, iv, layout);
                        var ev = {
                            x: ["HP", "ATK", "DEF", "SPA", "SPD", "SPE"],
                            y: poketeam[i].ev,
                            name: 'Trace2',
                            type: 'bar'
                        };
                        var ev = [ev];
                        var layout = {
                            xaxis: { title: 'Stats' },
                            yaxis: {
                                title: 'EV',
                                range: [0, 255]
                            },
                            barmode: 'fixed',
                            title: '',
                            color: 'rgba(245,246,249,1)'
                        };
                        Plotly.newPlot('evcontainer' + i, ev, layout);
                    }
                }
                createTeam();
                setTimeout(function(){
                    visualizeContent();
                }, 50)           
            </script>
        </div>
    </div>
</body>

</html>